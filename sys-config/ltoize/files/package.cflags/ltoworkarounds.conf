#Packages which require fat LTO objects in order to build (TESTING: STRIP_MASK)
#or which others depend on non-LTO symbols (previously was ltofat.conf)
#sys-libs/zlib *FLAGS+=-ffat-lto-objects
#dev-qt/designer *FLAGS+=-ffat-lto-objects
#dev-qt/qtdeclarative *FLAGS+=-ffat-lto-objects
#dev-qt/qtgui *FLAGS+=-ffat-lto-objects
#sys-apps/man-db *FLAGS+=-ffat-lto-objects
#dev-libs/boost *FLAGS+=-ffat-lto-objects
#net-libs/libndp *FLAGS+=-ffat-lto-objects
#dev-lang/tk *FLAGS+=-ffat-lto-objects
#dev-lang/tcl *FLAGS+=-ffat-lto-objects
dev-qt/qt-creator *FLAGS+=-ffat-lto-objects
#sys-boot/gnu-efi *FLAGS+=-ffat-lto-objects
dev-haskell/* *FLAGS+=-ffat-lto-objects #This is so non-portage GHC compilations work, as GHC is oblivious to LTO.  portage builds are fine.
media-libs/x264 *FLAGS+=-ffat-lto-objects
#net-wireless/mdk *FLAGS+=-ffat-lto-objects
sys-boot/syslinux *FLAGS+=-ffat-lto-objects
#mail-mta/nullmailer *FLAGS+=-ffat-lto-objects
app-editors/vim *FLAGS+=-ffat-lto-objects # required for perl USE flag
dev-lang/moarvm *FLAGS+=-ffat-lto-objects # required for perl6 (i.e., dev-lang/nqp and dev-lang/rakudo to build)
#dev-libs/glib *FLAGS+=-ffat-lto-objects # required to compile qemu
sci-libs/mpir *FLAGS+=-ffat-lto-objects # compilation error without fat LTO (not linking error)
#dev-lang/ocaml *FLAGS+=-ffat-lto-objects # necessary not for OCaml itself, but certain OCaml libraries
#dev-ml/camlbz2 *FLAGS+=-ffat-lto-objects

#Packages which cannot be built with LTO at all (previously was nolto.conf)
app-emulation/qemu *FLAGS-=-flto* *FLAGS+=-fno-strict-aliasing # required to compile qemu
dev-qt/qtcore *FLAGS-=-flto*
dev-qt/qtscript *FLAGS-=-flto*
media-libs/alsa-lib *FLAGS-=-flto*
dev-libs/wayland *FLAGS-=-flto*
dev-libs/elfutils *FLAGS-=-flto* 
dev-qt/qtwebengine *FLAGS-=-flto*
dev-qt/qtwebkit *FLAGS-=-flto* 
dev-lang/rust *FLAGS-=-flto*
dev-util/cargo *FLAGS-=-flto*
dev-util/cmocka *FLAGS-=-flto*
dev-util/valgrind *FLAGS-=-flto*
app-text/texlive-core *FLAGS-=-flto*
dev-libs/libaio *FLAGS-=-flto*
media-sound/pulseaudio *FLAGS-=-flto*
dev-db/mariadb *FLAGS-=-flto*
sci-libs/arrayfire *FLAGS-=-flto*
dev-lang/perl *FLAGS-=-flto*
net-misc/dhcp *FLAGS-=-flto* # Cannot be built with LTO by default, but can if "server" USE is disabled
sys-devel/gdb *FLAGS-=-flto*
dev-lang/spidermonkey *FLAGS-=-flto*
net-misc/nx *FLAGS-=-flto*
net-wireless/aircrack-ng *FLAGS-=-flto*
app-office/libreoffice *FLAGS-=-flto* # configure: error: Your gcc is not -fvisibility=hidden safe. This is no longer supported.
net-libs/webkit-gtk:3 *FLAGS-=-flto*
net-libs/webkit-gtk:4 *FLAGS-=-flto*
media-video/mplayer *FLAGS-=-flto*
kde-apps/dolphin *FLAGS-=-flto*
dev-python/notify-python *FLAGS-=-flto* # Required to fix the build process itself, where a variable substitution isn't working correctly

# BEGIN: Packages known as FIXED
#app-text/mupdf *FLAGS-=-flto*
#dev-libs/botan *FLAGS-=-flto*
#dev-libs/libgcrypt *FLAGS-=-flto*
#sys-apps/grep *FLAGS-=-flto* #verify this
#sys-apps/pciutils *FLAGS-=-flto*
#www-client/firefox *FLAGS-=-flto* #pgo xor lto
#media-libs/lcms *FLAGS-="${GRAPHITE}"
#sys-apps/man-db *FLAGS-="${GRAPHITE}"
#dev-lang/python *FLAGS-="${GRAPHITE}"
# END: Packages known as FIXED

# BEGIN: Packages known to ignore all flags
# app-editors/vim # forces -O2 and keeps other flags
# app-editors/vim-core # forces -O2 and keeps other flags
# dev-lang/nasm
# dev-libs/crypto++ # forces -O2 and keeps other flags
# dev-libs/nss
# media-libs/libsdl2 # custom-cflags masked by profile but builds w/o any problems when forced
# net-im/pidgin
# sys-devel/binutils
# sys-devel/gcc
# sys-libs/glibc
# x11-libs/gtk+:2
# END: Packages known to ignore all flags

# BEGIN: Additional flags required
#dev-qt/qtcore EXTRA_CXXFLAGS="${CXXFLAGS}" EXTRA_LFLAGS="${LDFLAGS}" # hack to build QtCore w/ LTO
#media-libs/adplug CFLAGS+=-fgnu89-inline # ../src/.libs/libadplug.so: undefined reference to `OPL_KEYON'
sys-libs/ncurses LDFLAGS+=-ldl # checking whether able to link to dl*() functions... configure: error: Cannot link test program for libdl
# END: Additional flags required

# BEGIN: LTO not recommended  
# Packages which can be built with LTO but leads to problems/crashes/segfaults
media-sound/jack2 *FLAGS-=-flto* # segfault in libjack.so.0.1.0 when ANY app trying to use it (breaks everithing built w/ JACK support)
net-misc/openssh *FLAGS-=-flto* # hangs on exit with lto
# END: LTO not recommended

# BEGIN: genkernel no LTO needs for initramfs use of LVM + LUKS
sys-apps/util-linux *FLAGS-=-flto*
sys-fs/eudev *FLAGS-=-flto*
sys-fs/udev *FLAGS-=-flto*
sys-fs/cryptsetup *FLAGS-=-flto*
dev-libs/popt *FLAGS-=-flto*
dev-libs/openssl *FLAGS-=-flto*
dev-libs/libressl *FLAGS-=-flto*
sys-fs/dmraid *FLAGS-=-flto*
# END: genkernel no LTO needs for initramfs use of LVM + LUKS

#Packages which Graphite optimizations don't play nice with
# BEGIN: Graphite ICE (Internal Compiler Error)
# Report them to GCC team
app-emulation/wine* *FLAGS-=-flto* *FLAGS-="${GRAPHITE}" # +custom-cflags # In function ‘arc2polybezier’: gdiplus.c:223:5: internal compiler error: in extract_affine, at graphite-sese-to-poly.c:272
media-libs/libvorbis *FLAGS-="${GRAPHITE}" # In function 'run_test': sharedbook.c:543:6: internal compiler error: in outer_projection_mupa, at graphite-sese-to-poly.c:1019
media-video/ffmpeg *FLAGS-=-flto* *FLAGS-="${GRAPHITE}" # In function ‘ff_nelly_get_sample_bits’: nellymoser.c:116:6: internal compiler error: in outer_projection_mupa, at graphite-sese-to-poly.c:1019
# END: Graphite ICE (Internal Compiler Error)

#Packages which don't play nice with glibc 2.26 or have other build problems not related to this configuration
#sys-devel/flex << fails to build regardless due to upstream bug 2.6.4
#sys-libs/gpm 
#the_silver_searcher << ebuild broken
#net-misc/nx
#sys-libs/ldb -- complains of missing python pytevent module, found in samba (package tevent)
#net-fs/samba -- same reason
#sys-libs/compiler-rt-sanitizers

#Packages which require build workarounds to be built with LTO that can be resolved directly in *FLAGS
sys-devel/gettext *FLAGS+=-lm # needed for linker to resolve libm's log10 -- only needed for LTO
x11-libs/wxGTK NOLDADD=1
